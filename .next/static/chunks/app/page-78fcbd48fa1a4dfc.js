(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{7:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>N});var a=n(5155),s=n(7017),r=n(6715),o=n(192),i=n(2115),l=n(1018),c=n(2960),d=n(2020),u=n(5041),h=n(5695),g=n(6874),x=n.n(g),m=n(6735),p=n(3734);let b="http://localhost:3000/api/todolist";async function j(){let{kw:e="",status:t="",order:n="asc",sortField:a="todo",currentPage:s=1,pageSize:r=10}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=new URLSearchParams;e&&o.append("kw",e),t&&o.append("status",t),n&&o.append("order",n),a&&o.append("sortField",a),o.append("page",String(s)),o.append("limit",String(r));let i=await fetch("".concat(b,"/?").concat(o.toString()));if(!i.ok)throw Error("Failed to fetch");return i.json()}async function y(e){let{id:t,todo:n}=e;return(await fetch(b,{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({id:t,todo:n})})).json()}async function f(e){let{id:t}=e;return(await fetch("".concat(b,"/").concat(t),{method:"DELETE"})).json()}async function S(e){let{id:t,status:n,todo:a}=e,s={};return void 0!==n&&(s.status=n),void 0!==a&&(s.todo=a),(await fetch("".concat(b,"/").concat(t),{method:"PATCH",headers:{"Content-type":"application/json"},body:JSON.stringify(s)})).json()}function v(){let e=(0,h.useSearchParams)(),t=(0,h.useRouter)(),n=e.get("kw")||"",s=e.get("status")||"",o=Number(e.get("page"))||1,l=e.get("order")||"asc",g=e.get("sortField")||"todo",[b,v]=(0,i.useState)(n),[N,w]=(0,i.useState)(""),[k,C]=(0,i.useState)(null),[T,D]=(0,i.useState)(""),F=(0,r.jE)(),P=n=>{let a=new URLSearchParams(e.toString());a.set("kw",n),t.push("?".concat(a.toString()))},{data:E,isLoading:O,isFetching:K}=(0,c.I)({queryKey:["todos",n,s,l,g,o,10],queryFn:async()=>{console.log("\uD83D\uDD04 QueryFn called with:",{kw:n,status:s,order:l,sortField:g,currentPage:o,pageSize:10});let e=await j({kw:n,status:s,order:l,sortField:g,currentPage:o,pageSize:10});return console.log("✅ QueryFn result:",e),e},staleTime:3e4,gcTime:3e5,placeholderData:d.rX,enabled:!0});console.log("\uD83D\uDD11 QueryKey:",["todos",n,s,l,g,o,10]),(0,i.useEffect)(()=>{E&&console.log("➡️ Current page:",o,"Data:",E)},[E]);let L=(0,u.n)({mutationFn:y,onSuccess:()=>{F.invalidateQueries({queryKey:["todos"]})}}),R=(0,u.n)({mutationFn:f,onSuccess:()=>{F.invalidateQueries({queryKey:["todos"]}),D("")}}),q=(0,u.n)({mutationFn:S,onSuccess:()=>{F.invalidateQueries({queryKey:["todos"]})}}),U=Array.isArray(null==E?void 0:E.todos)?E.todos.map(e=>({...e,createdDate:e.createdDate})):[],A=e=>(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)("button",{className:"px-2 py-1 rounded bg-red-200 text-red-800 hover:bg-red-500 transition",onClick:()=>R.mutate({id:e.id}),children:"X\xf3a"}),(0,a.jsx)("button",{className:"px-2 py-1 rounded bg-yellow-200 text-yellow-800 hover:bg-yellow-400 transition ml-1",onClick:()=>q.mutate({id:e.id,status:!e.status}),children:"Đổi trạng th\xe1i"})]})});return console.log("\uD83D\uDD14 Render state:",{data:E,isLoading:O,isFetching:K}),(0,a.jsxs)("div",{className:"text-2x1 text-white mr-50 ml-50 mt-10 ",children:[(0,a.jsx)("div",{className:"basis-128 text-center font-bold mb-4 mr-50 ml-50 text-2xl bg-[#31a146] text-[#e4f2e6] rounded-2xl",children:(0,a.jsx)("p",{children:"TODOLIST"})}),(0,a.jsxs)("div",{className:"flex items-center gap-4 border bg-[#c2f1cb] mb-6 p-4 rounded-xl shadow ml-50 w-180 text-black",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{className:"text-black rounded-lg border border-indigo-400 focus:ring-2 focus:ring-indigo-500 px-4 py-2 w-56 outline-none transition",type:"text",value:N,onChange:e=>w(e.target.value),placeholder:"Viết todo mới"}),(0,a.jsx)("button",{className:"text-gray-100 px-4 py-2 rounded-lg font-semibold shadow hover:bg-lime-800 transition bg-[#c6c2aa]",onClick:()=>{N.trim()&&(L.mutate({id:Date.now(),todo:N}),w(""))},children:"Th\xeam Todo"})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("input",{className:"text-black rounded-lg border border-gray-500 focus:ring-2 focus:ring-indigo-400 px-4 py-2 w-44 outline-none transition",type:"text",value:b,onChange:e=>v(e.target.value),onKeyDown:e=>{"Enter"===e.key&&P(b)},onBlur:()=>P(b),placeholder:"T\xecm theo từ kh\xf3a"})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)(m.G3,{value:s,onChange:n=>{let a=new URLSearchParams(e.toString());a.set("status",null!=n?n:""),a.set("page","1"),t.push("?".concat(a.toString()))},children:[(0,a.jsx)(m.oK,{className:"text-black rounded-lg border border-gray-500 px-4 py-2 w-32 outline-none",displayValue:()=>"true"===s?"Done":"false"===s?"Pending":"Tất cả",placeholder:"Trạng th\xe1i"}),(0,a.jsxs)(m.Kc,{className:"border-indigo-400 text-black font-semibold bg-stone-200 rounded-2xl border-2 shadow-lg mt-2 divide-y divide-indigo-200",children:[(0,a.jsx)(m.jO,{value:"",className:"px-4 py-2 hover:bg-indigo-100 cursor-pointer rounded-t-2xl",children:"Tất cả"}),(0,a.jsx)(m.jO,{value:"true",className:"px-4 py-2 hover:bg-indigo-100 cursor-pointer",children:"Done"}),(0,a.jsx)(m.jO,{value:"false",className:"px-4 py-2 hover:bg-indigo-100 cursor-pointer rounded-b-2xl",children:"Pending"})]})]})})]}),(0,a.jsxs)("div",{className:"text-black ml-50 text-2xl ",children:["Tổng số: ",U.length," | Đ\xe3 ho\xe0n th\xe0nh:"," ",U.filter(e=>e.status).length," | Đang thực hiện:"," ",U.filter(e=>!e.status).length]}),(0,a.jsxs)("div",{className:"mr-50 ml-50",children:[(0,a.jsxs)("table",{className:"table-auto border-1 w-full text-black bg-white rounded-2xl",children:[(0,a.jsx)("thead",{className:"border-1 bg-[#2f8d40] h-10 text-white",children:(0,a.jsxs)("tr",{children:[(0,a.jsxs)("th",{children:["Todo",(0,a.jsxs)("button",{className:"ml-2 px-2 py-1 rounded bg-[#2f8d40] text-[#c6c2aa] hover:bg-indigo-200 transition",onClick:()=>{let n="todo"===g&&"asc"===l?"desc":"asc",a=new URLSearchParams(e.toString());a.set("order",n),a.set("sortField","todo"),t.push("?".concat(a.toString()))},title:"Sắp xếp theo bảng chữ c\xe1i",children:["todo"===g?"asc"===l?"▲":"▼":"↕"," "]})]}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsxs)("th",{children:["Created Date",(0,a.jsx)("button",{className:"ml-2 px-2 py-1 rounded bg-[#2f8d40] text-[#c6c2aa] hover:bg-indigo-200 transition",onClick:()=>{let n="asc"===l?"desc":"asc",a=new URLSearchParams(e.toString());a.set("order",n),a.set("sortField","createdDate"),t.push("?".concat(a.toString()))},title:"Sắp xếp theo bảng chữ c\xe1i",children:"createdDate"===g?"asc"===l?"▲":"▼":"↕"})]}),(0,a.jsx)("th",{children:"Actions"})]})}),(0,a.jsx)("tbody",{children:O||K?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:3,className:"text-center",children:"Đang tải..."})}):0===U.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:3,className:"text-center",children:"Kh\xf4ng c\xf3 kết quả"})}):U.map((e,t)=>(0,a.jsxs)("tr",{className:"border-1 h-10 ".concat(t%2==0?"bg-[#c2f1cb]":"bg-[#ebf1ec]"),children:[(0,a.jsx)("td",{className:"text-center",children:k===e.id?(0,a.jsx)("input",{value:T,onChange:e=>D(e.target.value),className:"",onBlur:()=>C(null),onKeyDown:t=>{"Enter"===t.key&&q.mutate({id:e.id,todo:T})},autoFocus:!0}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x(),{href:"/todo/".concat(e.id),children:e.todo}),(0,a.jsx)("button",{className:"ml-2 h-3",onClick:()=>{C(e.id),D(e.todo)},title:"Sửa todo",children:(0,a.jsx)(p.uxA,{size:16,color:"#CCC7BA"})})]})}),(0,a.jsx)("td",{className:"content-center",children:e.status?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.SE8,{className:"text-green-600 inline"})," Done"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.X,{className:"text-red-600 inline"})," Pending"]})}),(0,a.jsx)("td",{className:"text-center",children:e.createdDate?new Date(e.createdDate).toLocaleDateString("vi-VN"):""}),(0,a.jsx)("td",{className:"flex flex-row gap-2 justify-center",children:A(e)})]},e.id))})]}),(0,a.jsxs)("div",{className:"text-black mt-2",children:[(0,a.jsx)("button",{className:"px-3 py-1 rounded bg-[#c6c2aa] hover:bg-gray-300",disabled:o<=1,onClick:()=>{let n=new URLSearchParams(e.toString());n.set("page",String(o-1)),t.push("?".concat(n.toString()))},children:"Trang trước"}),(0,a.jsxs)("span",{className:"ml-55 mr-55",children:["Trang ",o," / ",E?Math.ceil(E.total/10):1]}),(0,a.jsx)("button",{className:"px-3 py-1 rounded bg-[#c6c2aa] hover:bg-gray-300",disabled:E&&o>=Math.ceil(E.total/10),onClick:()=>{let n=new URLSearchParams(e.toString());n.set("page",String(o+1)),t.push("?".concat(n.toString()))},children:"Trang sau"})]})]})]})}function N(){let e=new s.E({defaultOptions:{queries:{staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1}}});return(0,a.jsx)(l.default,{children:(0,a.jsxs)(r.Ht,{client:e,children:[(0,a.jsx)(i.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(v,{})}),(0,a.jsx)(o.E,{initialIsOpen:!1})]})})}},1018:(e,t,n)=>{"use strict";n.d(t,{default:()=>h});var a=n(5155),s=n(4540),r=n(1990),o=0;let i=(0,r.Z0)({name:"todoSlice",initialState:{items:[]},reducers:{addTodo:(e,t)=>{e.items.push({id:++o,todo:t.payload,completed:!1})},removeTodo:(e,t)=>{e.items=e.items.filter(e=>e.id!==t.payload)}}}),{addTodo:l,removeTodo:c}=i.actions,d=i.reducer,u=(0,r.U1)({reducer:{todos:d}});function h(e){let{children:t}=e;return(0,a.jsx)(s.Kq,{store:u,children:t})}},3539:(e,t,n)=>{Promise.resolve().then(n.bind(n,7))}},e=>{var t=t=>e(e.s=t);e.O(0,[545,159,635,837,441,684,358],()=>t(3539)),_N_E=e.O()}]);