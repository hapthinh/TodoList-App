"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[469],{3469:(e,t,n)=>{n.r(t),n.d(t,{default:()=>J});var a=n(5155),s=n(6715),l=n(2960),r=n(2020),i=n(7422),o=n(2115),c=n(5695),d=n(6766),u=n(2108),h=n(3734),x=n(9505),m=n(398),g=n(2110),j=n(8837),p=n(1116),f=n(6632),b=n(6490),v=n(8468),y=n(644),S=n(3613),A=n(6564),N=n(5808);let w="http://localhost:3000/api/todolist";async function C(){let{kw:e="",status:t="",order:n="asc",sortField:a="status",currentPage:s=1,pageSize:l=10}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new URLSearchParams;e&&r.append("kw",e),t&&r.append("status",t),n&&r.append("order",n),a&&r.append("sortField",a),r.append("page",String(s)),r.append("limit",String(l));let i=await fetch("".concat(w,"/?").concat(r.toString()));if(!i.ok)throw Error("Failed to fetch");return i.json()}async function F(e){let{todo:t}=e;return(await fetch(w,{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({todo:t})})).json()}async function k(e){let{id:t}=e;return(await fetch("".concat(w,"/").concat(t),{method:"DELETE"})).json()}async function D(e){let{id:t,completed:n,todo:a}=e;return(console.log("yeahhhhh"),a)?(await fetch("".concat(w,"/").concat(t),{method:"PATCH",headers:{"Content-type":"application/json"},body:JSON.stringify({todo:a})})).json():(await fetch("".concat(w,"/").concat(t),{method:"PATCH",headers:{"Content-type":"application/json"},body:JSON.stringify({completed:n})})).json()}async function P(e){let{idArray:t}=e;return(await fetch("".concat(w),{method:"DELETE",headers:{"Content-type":"application/json"},body:JSON.stringify(t)})).json()}function E(e){let{input:t,setInput:n,onAdd:s}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-1 ml-3 h-20",children:[(0,a.jsxs)("form",{action:"",children:[(0,a.jsx)("label",{className:"font-sans mb-3",children:"Add todo"}),(0,a.jsx)("input",{className:"text-black rounded-lg border border-gray-500 focus:ring-2 focus:ring-indigo-500 px-4 py-2 w-75 outline-none transition mb-8 h-12",type:"text",value:t,onChange:e=>n(e.target.value),placeholder:"Enter New Todo"})]}),(0,a.jsx)("button",{className:"text-black px-4 py-2 rounded-lg font-semibold shadow-black hover:bg-amber-600 transition bg-amber-200 w-20 ml-3 mr-3 h-12 mb-2.5",onClick:s,children:"Add"})]})}function T(e){let{searchInput:t,setSearchInput:n,handleSearch:s}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"flex items-center gap-2 h-18",children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s(e,t)},children:[(0,a.jsx)("label",{className:"ml-3 font-sans",children:"Search"}),(0,a.jsx)("input",{className:"text-black rounded-lg border border-gray-500 focus:ring-2 focus:ring-indigo-400 px-4 py-2 w-76 outline-none transition ml-3 mb-6.5 h-12",type:"text",value:t,onChange:e=>n(e.target.value),placeholder:"Enter Keyword"})]})})})}function L(e){let{completedCount:t,unCompletedCount:n}=e;return(0,a.jsxs)("div",{className:"text-black flex justify-center text-3xl font-bold gap-3",children:[(0,a.jsxs)("div",{children:["Total: ",t+n]})," | ",(0,a.jsx)("div",{children:(0,a.jsxs)("p",{className:"text-green-500",children:[" Done: ",t," "]})}),"| ",(0,a.jsx)("div",{children:(0,a.jsxs)("p",{className:"text-red-500",children:["Pending: ",n]})})]})}var z=n(9427),O=n(7348),I=n(6673),K=n(9591);function R(e){let{selectedOrder:t,searchParams:n,router:s}=e;return(0,a.jsx)("div",{className:"h-8",children:(0,a.jsxs)(z.A,{sx:{m:.5,minWidth:90},children:[(0,a.jsx)(O.A,{id:"demo-label",children:"Created Date"}),(0,a.jsxs)(K.A,{labelId:"demo-label",id:"demo",value:t,onChange:e=>{var t;let a=new URLSearchParams(n.toString());a.set("sortField","createdDate"),a.set("order",null!=(t=e.target.value)?t:""),a.set("page","1"),s.push("?".concat(a.toString()))},autoWidth:!0,label:"Created Date",children:[(0,a.jsx)(I.A,{value:"asc",children:"Asc"}),(0,a.jsx)(I.A,{value:"desc",children:"Desc"})]})]})})}function U(e){let{SelectedPageSize:t,onChangePageSize:n}=e;return(0,a.jsx)("div",{children:(0,a.jsxs)(z.A,{sx:{m:.5,minWidth:70},children:[(0,a.jsx)(O.A,{id:"demo label",children:"Page Size"}),(0,a.jsxs)(K.A,{labelId:"demo-label",id:"demo",value:t,onChange:e=>{n(Number(e.target.value))},autoWidth:!0,label:"Page Size",children:[(0,a.jsx)(I.A,{value:4,children:"4"}),(0,a.jsx)(I.A,{value:8,children:"8"}),(0,a.jsx)(I.A,{value:12,children:"12"})]})]})})}function q(e){let{selectStatus:t,searchParams:n,router:s}=e;return(0,a.jsx)("div",{children:(0,a.jsxs)(z.A,{sx:{m:.5,minWidth:90},children:[(0,a.jsx)(O.A,{id:"demo-label",children:"Status"}),(0,a.jsxs)(K.A,{labelId:"demo-label",id:"demo",value:t,onChange:e=>{var t;console.log(e.target.value);let a=new URLSearchParams(n.toString());a.set("status",null!=(t=e.target.value)?t:""),a.set("page","1"),s.push("?".concat(a.toString()))},autoWidth:!0,label:"Status",children:[(0,a.jsx)(I.A,{value:"",children:"All"}),(0,a.jsx)(I.A,{value:"true",children:"Done"}),(0,a.jsx)(I.A,{value:"false",children:"Pending"})]})]})})}var W=n(4507);function Q(e){let{currentPage:t,total:n,pageSize:s,router:l,searchParams:r}=e,i=Math.ceil(n/s);return console.log(t,n,s),(0,a.jsx)("div",{className:"flex justify-center my-6",children:(0,a.jsx)(W.A,{count:i,page:t,onChange:(e,t)=>{let n=new URLSearchParams(r.toString());n.set("page",String(t)),l.push("?".concat(n.toString()))}})})}function J(){let{data:e,status:t}=(0,u.useSession)(),n=(0,c.useRouter)(),w=(0,c.useSearchParams)(),z=(0,s.jE)();console.log(e),(0,o.useEffect)(()=>{"unauthenticated"===t&&n.push("/")},[t,n]);let[O,I]=(0,o.useState)(8),K=w.get("kw")||"",W=w.get("status")||"",J=Number(w.get("page"))||1,_=w.get("order")||"asc",H=w.get("sortField")||"status",M=Number(w.get("limit"))||O,[X,B]=(0,o.useState)(K),[V,Y]=(0,o.useState)(""),[G,Z]=(0,o.useState)(null),[$,ee]=(0,o.useState)(""),[et,en]=(0,o.useState)([]),[ea,es]=(0,o.useState)([]),el=e=>{let t=et.map((t,n)=>n===e?!t:t);en(t);let n=eh[e].id,a=[...ea];t[e]?a.push(n):a=a.filter(e=>e!==n),es(a)},{data:er,isLoading:ei}=(0,l.I)({queryKey:["todos",K,W,_,H,J,M],queryFn:async()=>{let e=await C({kw:K,status:W,order:_,sortField:H,currentPage:J,pageSize:M});return console.log("QueryFn result:",e),e},staleTime:3e4,gcTime:3e5,placeholderData:r.rX}),eo=(0,i.n)({mutationFn:F,onSuccess:()=>{z.invalidateQueries({queryKey:["todos",K,W,_,H,J,M]})}}),ec=(0,i.n)({mutationFn:k,onSuccess:()=>{z.invalidateQueries({queryKey:["todos",K,W,_,H,J,M]})}}),ed=(0,i.n)({mutationFn:P,onSuccess:()=>{z.invalidateQueries({queryKey:["todos",K,W,_,H,J,M]}),en(Array(eh.length).fill(!1)),es([])}}),eu=(0,i.n)({mutationFn:e=>{let{id:t,completed:n,todo:a}=e;return D({id:t,completed:n,todo:a})},onSuccess:()=>{z.invalidateQueries({queryKey:["todos",K,W,_,H,J,M]}),Z(null),ee("")}}),eh=Array.isArray(null==er?void 0:er.todos)?er.todos.map(e=>({...e,createdDate:e.createdDate})):[];return(0,o.useEffect)(()=>{en(Array(eh.length).fill(!1)),es([])},[eh.length]),(0,a.jsxs)("div",{className:"text-2x1 text-white bg-gradient-to-r from-amber-100 to-amber-300 h-full grid-cols-subgrid border-2 min-h-screen",children:[(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{className:"text-black hover:scale-150 text-3xl",onClick:()=>(0,u.signOut)({redirect:!1,callbackUrl:"/"}),children:(0,a.jsx)(N.A,{fontSize:"large"})})}),(0,a.jsxs)("div",{className:"basis-128 text-center mb-4 text-5xl bg-gradient-to-r from-amber-100 to-amber-300 text-[#050505] font-extrabold flex justify-center mt-5",children:[(0,a.jsx)(d.default,{src:"/todo.svg",alt:"todo",width:40,height:40}),(0,a.jsx)("p",{className:"ml-2",children:"YourTODO"})]}),(0,a.jsxs)("div",{className:"flex justify-items-center-safe ml-100 gap-4 mb-6 p-4 shadow w-280 text-black h-25 rounded-xl bg-[#eff1a0]",children:[(0,a.jsx)("div",{className:"w-100 bg-[#FEFFDF] flex-1/3 rounded-xl",children:(0,a.jsx)(E,{input:V,setInput:Y,onAdd:()=>{V.trim()&&(eo.mutate({todo:V}),Y(""))}})}),(0,a.jsx)("div",{className:"flex-1/3 bg-[#FEFFDF] rounded-xl flex justify-center",children:(0,a.jsx)(T,{searchInput:X,setSearchInput:B,handleSearch:(e,t)=>{e.preventDefault();let a=new URLSearchParams(w.toString());a.set("kw",t),a.set("page","1"),n.push("?".concat(a.toString())),B("")}})}),(0,a.jsx)("div",{className:"flex flex-1/3 justify-center bg-[#FEFFDF] rounded-xl",children:(0,a.jsxs)("div",{className:"flex flex-row mt-0.5",children:[(0,a.jsx)(q,{selectStatus:W,searchParams:w,router:n}),(0,a.jsx)(R,{selectedOrder:_,searchParams:w,router:n}),(0,a.jsx)(U,{SelectedPageSize:O,onChangePageSize:e=>{let t=new URLSearchParams(w.toString());t.set("limit",String(e)),t.set("page","1"),n.push("?".concat(t.toString())),I(e)}})]})})]}),(0,a.jsx)("div",{children:er&&(0,a.jsx)(L,{completedCount:er.completedCount||0,unCompletedCount:er.unCompletedCount||0})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("div",{children:(0,a.jsx)(A.A,{children:(0,a.jsx)(v.A,{variant:"outlined",color:"primary",startIcon:(0,a.jsx)(A.A,{badgeContent:et.filter(Boolean).length,color:"error",children:(0,a.jsx)(x.A,{})}),onClick:()=>{ed.mutate({idArray:ea}),console.log(ea)},className:"flex justify-items-end",disabled:0===ea.length,children:"Delete Selected Todo"})})})}),ei?(0,a.jsx)("div",{className:"text-center",children:"Loading..."}):0===eh.length?(0,a.jsx)("div",{className:"text-center",children:"No result"}):(0,a.jsx)("div",{className:"ml-20 mt-10",children:(0,a.jsx)(g.A,{container:!0,spacing:4,sx:{justifyContent:"space-between"},columns:{xs:4,sm:8,md:12},children:eh.map((e,t)=>(0,a.jsx)(g.A,{size:3,justifyContent:"space-between",children:(0,a.jsxs)(j.A,{sx:{width:350,backgroundColor:"#FEFFDF",border:1,boxShadow:10},children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("div",{children:(0,a.jsx)(S.A,{size:"small",color:"success",checked:!!et[t],onChange:()=>el(t)})}),(0,a.jsx)("div",{}),(0,a.jsx)("div",{className:"text-2xl mr-2",children:e.createdDate?new Date(e.createdDate).toLocaleDateString("vi-VN"):""})]}),(0,a.jsxs)(f.A,{children:[(0,a.jsx)(p.A,{align:"center",variant:"h5",children:G===e.id?(0,a.jsx)("input",{value:$,onChange:e=>ee(e.target.value),type:"text",onKeyDown:t=>{"Enter"===t.key&&eu.mutate({id:e.id,todo:$})}}):(0,a.jsxs)("div",{children:[e.todo,(0,a.jsx)("button",{className:"ml-1",onClick:()=>{Z(e.id),ee(e.todo)},children:(0,a.jsx)(y.A,{color:"action"})})]})}),(0,a.jsx)(p.A,{variant:"h6",align:"center",children:e.completed?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.SE8,{className:"text-green-600 inline"})," Done"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.X,{className:"text-red-600 inline"})," Pending"]})}),(0,a.jsx)(p.A,{})]}),(0,a.jsxs)(b.A,{sx:{backgroundColor:"#fafafa",justifyContent:"space-around"},children:[(0,a.jsxs)(v.A,{disabled:e.completed,onClick:()=>{eu.mutate({id:e.id,completed:!e.completed})},children:[(0,a.jsx)(m.A,{}),"Mark Done"]}),(0,a.jsxs)(v.A,{color:"error",onClick:()=>ec.mutate({id:e.id}),children:[(0,a.jsx)(x.A,{}),"Delete"]})]})]})},e.id))})}),er&&(0,a.jsx)(Q,{currentPage:J,total:er.total,pageSize:M,router:n,searchParams:w})]})}}}]);